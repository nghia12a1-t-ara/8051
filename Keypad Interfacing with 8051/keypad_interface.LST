C51 COMPILER V9.60.0.0   KEYPAD_INTERFACE                                                  05/10/2021 20:03:17 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEYPAD_INTERFACE
OBJECT MODULE PLACED IN keypad_interface.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE keypad_interface.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*
   2            4x4 Keypad Interfacing with 8051(AT89s52)
   3            http://www.electronicwings.com
   4          */
   5          
   6          
   7          #include<reg52.h>
   8          #include<stdio.h>
   9          #include<string.h>
  10          #include "LCD_8_bit.h"    /* 16x2 LCD header file*/
  11          
  12          #define keyport P1
  13          
  14          sbit RS     = P3^5;       /* RS(register select) for LCD16x2 */
  15          sbit RW     = P3^6;       /* RW(Read/write) for LCD16x2 */
  16          sbit ENABLE = P3^7;       /* EN(Enable) pin for LCD16x2*/
  17          
  18          unsigned char keypad[4][4] = {{'7','8','9','/'},
  19                                        {'4','5','6','x'},
  20                                        {'1','2','3','-'},
  21                                        {' ','0','=','+'} };
  22          
  23          unsigned char colloc, rowloc;
  24                                    
  25          unsigned char key_detect()
  26          {
  27   1          /* F <=> Input pullup <=> COL, 0 <=> OUTPUT <=> ROW */
  28   1          keyport=0xF0;             
  29   1          /*set port direction as input-output*/
  30   1          do
  31   1          {
  32   2            keyport = 0xF0;       
  33   2            colloc = keyport;
  34   2            colloc &= 0xF0;       /* mask port for column read only */
  35   2          }while(colloc != 0xF0);   /* read status of column */
  36   1        
  37   1            do
  38   1            {
  39   2              do
  40   2              {
  41   3                delay(20);                  /* 20ms key debounce time */
  42   3                colloc = (keyport & 0xF0);  /* read status of column */
  43   3              }while(colloc == 0xF0);       /* check for any key press */
  44   2          
  45   2              delay(1);
  46   2              colloc = (keyport & 0xF0);
  47   2            }while(colloc == 0xF0);
  48   1            
  49   1        /* Key detect - Row & Col */
  50   1        while(1)
  51   1        {
  52   2          /* now check for rows */
  53   2            keyport= 0xFE;          /* 0b1111.1110 */         /* check for pressed key in 1st row */
  54   2            colloc = (keyport & 0xF0);    /* 0b1011.0000 */   /* Colloc = 0xB0 */
  55   2            if(colloc != 0xF0)      /* check button click */
C51 COMPILER V9.60.0.0   KEYPAD_INTERFACE                                                  05/10/2021 20:03:17 PAGE 2   

  56   2            {
  57   3              rowloc = 0;       /* clicked button is in 1st row */
  58   3              break;
  59   3            }
  60   2      
  61   2            keyport = 0xFD;       /* 0b1111.1101 */         /* check for pressed key in 2nd row */
  62   2            colloc = (keyport & 0xF0);  /* 0b1111.0000 */   /* Colloc = 0xF0 */
  63   2            if(colloc != 0xF0)  /* check button click */
  64   2            {
  65   3              rowloc = 1;       /* clicked button is in 2nd row */
  66   3              break;
  67   3            }
  68   2            
  69   2            keyport = 0xFB;                 /* check for pressed key in 3rd row */
  70   2            colloc = (keyport & 0xF0);
  71   2            if(colloc != 0xF0)
  72   2            {
  73   3              rowloc = 2;
  74   3              break;
  75   3            }
  76   2      
  77   2            keyport = 0xF7;                 /* check for pressed key in 4th row */
  78   2            colloc = (keyport & 0xF0);
  79   2            if(colloc != 0xF0)
  80   2            {
  81   3              rowloc = 3;
  82   3              break;
  83   3            } 
  84   2        }
  85   1        
  86   1          if(colloc == 0xE0)
  87   1          {
  88   2            return(keypad[rowloc][0]);
  89   2          }   
  90   1          else if(colloc == 0xD0)
  91   1          {
  92   2            return(keypad[rowloc][1]);
  93   2          } 
  94   1          else if(colloc == 0xB0)
  95   1          {
  96   2            return(keypad[rowloc][2]);
  97   2          } 
  98   1          else
  99   1          {
 100   2            return(keypad[rowloc][3]);
 101   2          } 
 102   1      }
 103          
 104          
 105          int main(void)
 106          {
 107   1        LCD_Init();
 108   1        LCD_String_xy(1,0,"Press a key");
 109   1        
 110   1        while(1){
 111   2          LCD_Command(0xc0);
 112   2          LCD_Char(key_detect());             /* Display which key is pressed */
 113   2        }   
 114   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.60.0.0   KEYPAD_INTERFACE                                                  05/10/2021 20:03:17 PAGE 3   

   CODE SIZE        =    214    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
